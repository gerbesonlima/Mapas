<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Saída de Campo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">
    <div class="container mx-auto p-2 sm:p-4">
        <div id="content">
            <div class="mb-4">
                <h2 class="text-lg sm:text-xl font-bold mb-2">Programação de Saída de Campo</h2>
                <div class="flex flex-col sm:flex-row gap-2 mb-4">
                    <button onclick="editTable('field')" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 text-sm sm:text-base">Editar</button>
                    <button onclick="saveTable('field')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 text-sm sm:text-base">Salvar</button>
                    <button onclick="downloadPDF('field')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 text-sm sm:text-base">Baixar PDF</button>
                    <button onclick="addRow('field')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 text-sm sm:text-base">Adicionar Linha</button>
                </div>
                <div class="overflow-x-auto">
                    <table id="field-table" class="w-full border-collapse text-sm sm:text-base">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="border p-1 sm:p-2 text-xs sm:text-sm">Dia</th>
                                <th class="border p-1 sm:p-2 text-xs sm:text-sm">Local de Saída</th>
                                <th class="border p-1 sm:p-2 text-xs sm:text-sm">Horário da Consideração</th>
                                <th class="border p-1 sm:p-2 text-xs sm:text-sm">Dirigente</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Terça-Feira</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Quarta-Feira</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Quinta-Feira</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Sexta-Feira</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Sábado</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                            <tr>
                                <td class="border p-1 sm:p-2 text-xs sm:text-sm">Domingo</td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD75RGb3lOiZ0azcSjtP_b9VcZPlHCelJY",
            authDomain: "territorios-3d0bb.firebaseapp.com",
            projectId: "territorios-3d0bb",
            storageBucket: "territorios-3d0bb.firebasestorage.app",
            messagingSenderId: "712377474662",
            appId: "1:712377474662:web:dfb86ef024b18aa2cb97a7",
            measurementId: "G-DME60YZGXX",
            databaseURL: "https://territorios-3d0bb-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const { jsPDF } = window.jspdf;

        // Carregar dados ao iniciar a página
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        function editTable(tableId) {
            const textareas = document.querySelectorAll(`#${tableId}-table textarea`);
            textareas.forEach(textarea => textarea.disabled = false);
        }

        function addRow(tableId) {
            const table = document.getElementById(`${tableId}-table`).querySelector('tbody');
            const day = prompt('Digite o dia da semana (ex: Segunda-Feira):');
            if (!day) return;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td class="border p-1 sm:p-2 text-xs sm:text-sm">${day}</td>
                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
            `;
            table.appendChild(newRow);
        }

        function saveTable(tableId) {
            const textareas = document.querySelectorAll(`#${tableId}-table textarea`);
            textareas.forEach(textarea => textarea.disabled = true);

            const table = document.getElementById(`${tableId}-table`);
            const data = [];
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const textareas = row.querySelectorAll('textarea');
                data.push({
                    day: cells[0].textContent,
                    location: textareas[0].value,
                    time: textareas[1].value,
                    leader: textareas[2].value
                });
            });

            database.ref(`schedules/${tableId}`).set(data).then(() => {
                alert('Dados salvos com sucesso!');
            }).catch(error => {
                alert('Erro ao salvar dados: ' + error.message);
            });
        }

        function loadData() {
            database.ref('schedules/field').once('value', (snapshot) => {
                const data = snapshot.val() || [];
                const table = document.getElementById('field-table').querySelector('tbody');
                table.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border p-1 sm:p-2 text-xs sm:text-sm">${item.day}</td>
                        <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled>${item.location || ''}</textarea></td>
                        <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled>${item.time || ''}</textarea></td>
                        <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled>${item.leader || ''}</textarea></td>
                    `;
                    table.appendChild(row);
                });
                if (data.length === 0) {
                    const defaultDays = [
                        'Terça-Feira',
                        'Quarta-Feira',
                        'Quinta-Feira',
                        'Sexta-Feira',
                        'Sábado',
                        'Domingo'
                    ];
                    defaultDays.forEach(day => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="border p-1 sm:p-2 text-xs sm:text-sm">${day}</td>
                            <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                            <td class="border p-1 sm:p-2"><textarea class="w-full p-1 text-xs sm:text-sm h-12 sm:h-16 resize-none" disabled></textarea></td>
                        `;
                        table.appendChild(row);
                    });
                }
            });
        }

        function downloadPDF(tableId) {
            try {
                const doc = new jsPDF();
                doc.setFontSize(12);
                doc.text('Programação de Saída de Campo', 10, 10);
                const table = document.getElementById('field-table');
                const data = [];
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const textareas = row.querySelectorAll('textarea');
                    data.push([
                        cells[0].textContent,
                        textareas[0].value || '',
                        textareas[1].value || '',
                        textareas[2].value || ''
                    ]);
                });

                doc.autoTable({
                    head: [['Dia', 'Local de Saída', 'Horário da Consideração', 'Dirigente']],
                    body: data,
                    startY: 20,
                    styles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 30 },
                        1: { cellWidth: 50 },
                        2: { cellWidth: 50 },
                        3: { cellWidth: 50 }
                    }
                });
                doc.save('Programacao_Saida_Campo.pdf');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF: ' + error.message);
            }
        }
    </script>
    <script>
        (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93a85d07aa5badc6',t:'MTc0NjM2NTUzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
</body>
</html>