<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Saída de Campo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <div id="content">
            <div class="mb-4">
                <h2 class="text-xl font-bold">Programação de Saída de Campo</h2>
                <button onclick="editTable('field')" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Editar</button>
                <button onclick="saveTable('field')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Salvar</button>
                <button onclick="downloadPDF('field')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Baixar PDF</button>
                <button onclick="addRow('field')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Adicionar Linha</button>
                <table id="field-table" class="w-full border-collapse mt-2">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="border p-2">Dia</th>
                            <th class="border p-2">Local de Saída</th>
                            <th class="border p-2">Horário da Consideração</th>
                            <th class="border p-2">Dirigente</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border p-2">Terça-Feira</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                        <tr>
                            <td class="border p-2">Quarta-Feira</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                        <tr>
                            <td class="border p-2">Quinta-Feira</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                        <tr>
                            <td class="border p-2">Sexta-Feira</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                        <tr>
                            <td class="border p-2">Sábado</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                        <tr>
                            <td class="border p-2">Domingo</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD75RGb3lOiZ0azcSjtP_b9VcZPlHCelJY",
            authDomain: "territorios-3d0bb.firebaseapp.com",
            projectId: "territorios-3d0bb",
            storageBucket: "territorios-3d0bb.firebasestorage.app",
            messagingSenderId: "712377474662",
            appId: "1:712377474662:web:dfb86ef024b18aa2cb97a7",
            measurementId: "G-DME60YZGXX",
            databaseURL: "https://territorios-3d0bb-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const { jsPDF } = window.jspdf;

        // Carregar dados ao iniciar a página
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        function editTable(tableId) {
            const textareas = document.querySelectorAll(`#${tableId}-table textarea`);
            textareas.forEach(textarea => textarea.disabled = false);
        }

        function addRow(tableId) {
            const table = document.getElementById(`${tableId}-table`).querySelector('tbody');
            const day = prompt('Digite o dia da semana (ex: Segunda-Feira):');
            if (!day) return;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td class="border p-2">${day}</td>
                <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
            `;
            table.appendChild(newRow);
        }

        function saveTable(tableId) {
            const textareas = document.querySelectorAll(`#${tableId}-table textarea`);
            textareas.forEach(textarea => textarea.disabled = true);

            const table = document.getElementById(`${tableId}-table`);
            const data = [];
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const textareas = row.querySelectorAll('textarea');
                data.push({
                    day: cells[0].textContent,
                    location: textareas[0].value,
                    time: textareas[1].value,
                    leader: textareas[2].value
                });
            });

            database.ref(`schedules/${tableId}`).set(data).then(() => {
                alert('Dados salvos com sucesso!');
            }).catch(error => {
                alert('Erro ao salvar dados: ' + error.message);
            });
        }

        function loadData() {
            database.ref('schedules/field').once('value', (snapshot) => {
                const data = snapshot.val() || [];
                const table = document.getElementById('field-table').querySelector('tbody');
                table.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border p-2">${item.day}</td>
                        <td class="border p-2"><textarea class="w-full p-1" disabled>${item.location || ''}</textarea></td>
                        <td class="border p-2"><textarea class="w-full p-1" disabled>${item.time || ''}</textarea></td>
                        <td class="border p-2"><textarea class="w-full p-1" disabled>${item.leader || ''}</textarea></td>
                    `;
                    table.appendChild(row);
                });
                if (data.length === 0) {
                    const defaultDays = [
                        'Terça-Feira',
                        'Quarta-Feira',
                        'Quinta-Feira',
                        'Sexta-Feira',
                        'Sábado',
                        'Domingo'
                    ];
                    defaultDays.forEach(day => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="border p-2">${day}</td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                            <td class="border p-2"><textarea class="w-full p-1" disabled></textarea></td>
                        `;
                        table.appendChild(row);
                    });
                }
            });
        }

        function downloadPDF(tableId) {
            try {
                const doc = new jsPDF();
                doc.setFontSize(12);
                doc.text('Programação de Saída de Campo', 10, 10);
                const table = document.getElementById('field-table');
                const data = [];
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const textareas = row.querySelectorAll('textarea');
                    data.push([
                        cells[0].textContent,
                        textareas[0].value || '',
                        textareas[1].value || '',
                        textareas[2].value || ''
                    ]);
                });

                doc.autoTable({
                    head: [['Dia', 'Local de Saída', 'Horário da Consideração', 'Dirigente']],
                    body: data,
                    startY: 20
                });
                doc.save('Programacao_Saida_Campo.pdf');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF: ' + error.message);
            }
        }
    </script>
</body>
</html>